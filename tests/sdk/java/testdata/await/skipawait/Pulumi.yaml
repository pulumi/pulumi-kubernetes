name: skipawait
runtime: yaml
description: |
  Tests the skipAwait annotation:
  - A slow-to-start deployment tests create/update/read.
  - Delete is tested with a config map with a stuck finalizer.
resources:
  stuck-config:
    type: kubernetes:core/v1:ConfigMap
    properties:
      metadata:
        finalizers:
          - pulumi.com/stuck
        annotations:
          pulumi.com/skipAwait: "true"
      data:
        foo: bar

  slow-pod:
    type: kubernetes:core/v1:Pod
    properties:
      metadata:
        annotations:
          pulumi.com/skipAwait: "true"
      spec:
        containers:
          - image: busybox
            name: busybox
            command: ["sleep", "infinity"]
            readinessProbe:
              exec:
                command:
                  - ls
              initialDelaySeconds: 600 # 10 minutes!
              periodSeconds: 10
