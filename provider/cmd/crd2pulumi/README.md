# Generating strongly-typed Kubernetes CRDs (Custom Resource Definitions)

## Usage

If you have some Kubernetes CRD properly defined in some file `resourcedefinition.yaml` and you want to generate a code snippet of strongly typed interfaces for that schema, you can run:

```bash
$ go run . <resourcedefinition.yaml> [output file path]
```

If the output file path is not specified, then it is automatically created in
the same directory as `resourcedefinition.yaml`.

## Examples
If we defined a CronTab CRD from the [Kubernetes Docs](https://kubernetes.io/docs/tasks/extend-kubernetes/custom-resources/custom-resource-definitions/) in `resourcedefinition.yaml`:

```yaml
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  # name must match the spec fields below, and be in the form: <plural>.<group>
  name: crontabs.stable.example.com
spec:
  # group name to use for REST API: /apis/<group>/<version>
  group: stable.example.com
  # list of versions supported by this CustomResourceDefinition
  versions:
    - name: v1
      # Each version can be enabled/disabled by Served flag.
      served: true
      # One and only one version must be marked as the storage version.
      storage: true
      schema:
        openAPIV3Schema:
          type: object
          properties:
            spec:
              type: object
              properties:
                cronSpec:
                  type: string
                image:
                  type: string
                replicas:
                  type: integer
  # either Namespaced or Cluster
  scope: Namespaced
  names:
    # plural name to be used in the URL: /apis/<group>/<version>/<plural>
    plural: crontabs
    # singular name to be used as an alias on the CLI and for display
    singular: crontab
    # kind is normally the CamelCased singular type. Your resource manifests use this.
    kind: CronTab
    # shortNames allow shorter string to match your resource on the CLI
    shortNames:
    - ct
```
And ran the command:
```bash
$ go run . resourcedefinition.yaml
```
It would generate a file called `crontabs.ts` by default:
```typescript
// *** This file was generated by crd2pulumi. ***

import * as pulumi from "@pulumi/pulumi";
import * as k8s from "@pulumi/kubernetes";

type ObjectMeta = k8s.types.input.meta.v1.ObjectMeta;

export namespace v1 {
    export interface CronTabArgs {
        metadata?: pulumi.Input<ObjectMeta>;
        spec?: pulumi.Input<v1.CronTabSpec>;
    }

    export interface CronTabSpec {
        cronSpec?: pulumi.Input<string>;
        image?: pulumi.Input<string>;
        replicas?: pulumi.Input<number>;
    }
}

export namespace v1 {
	export class CronTab extends k8s.apiextensions.CustomResource {
		public static getCronTab(name: string, id: pulumi.Input<pulumi.ID>): CronTab {
			return k8s.apiextensions.CustomResource.get(name, { apiVersion: "stable.example.com/v1", kind: "CronTab", id: id })
		}

		constructor(name: string, args?: v1.CronTabArgs, opts?: pulumi.CustomResourceOptions) {
			super(name, { apiVersion: "stable.example.com/v1", kind: "CronTab", ...args }, opts)
		}
	}
}

export class CronTabDefinition extends k8s.apiextensions.v1.CustomResourceDefinition {
	constructor(name: string, opts?: pulumi.CustomResourceOptions) {
		super(name, {
			"apiVersion": "apiextensions.k8s.io/v1",
			"kind": "CustomResourceDefinition",
			"metadata": {
				"name": "crontabs.stable.example.com"
			},
			"spec": {
				"group": "stable.example.com",
				"names": {
					"kind": "CronTab",
					"plural": "crontabs",
					"shortNames": [
						"ct"
					],
					"singular": "crontab"
				},
				"scope": "Namespaced",
				"versions": [
					{
						"name": "v1",
						"schema": {
							"openAPIV3Schema": {
								"properties": {
									"spec": {
										"properties": {
											"cronSpec": {
												"type": "string"
											},
											"image": {
												"type": "string"
											},
											"replicas": {
												"type": "integer"
											}
										},
										"type": "object"
									}
								},
								"type": "object"
							}
						},
						"served": true,
						"storage": true
					}
				]
			}
		}, opts)
	}
}
```
